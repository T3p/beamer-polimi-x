\documentclass{beamer}
\usepackage{lmodern}
\usepackage[utf8]{inputenc}

\usepackage{enumerate}
\usepackage{multimedia}
\usepackage{bbm}

\usetheme{polimix}

%My commands
\newcommand{\expect}[2]{\mathop{E}_{#1}\left[#2\right]}
\newcommand{\hold}{\addtocounter{framenumber}{-1}}
% % % %
 
\title[Short title]{Long title}
\subtitle{subtitle}

\title[Retrace]{Retrace($\lambda$)}
\subtitle{Temporal Credit Assignment in Off-Policy Reinforcement Learning}

\author[Matteo Papini]{Matteo Papini}
\date[28/11/17]{28th November 2017}

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\titlepage
\end{frame}

\addtocounter{framenumber}{-1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Before we start...}
\end{frame}

\begin{frame}
\frametitle{Syllabus}
\tableofcontents
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
\frame{\tableofcontents[currentsection]}

\begin{frame}
\frametitle{Reinforcement Learning}
\end{frame}

\begin{frame}
\frametitle{Value Function}
\end{frame}

\begin{frame}
\frametitle{Policy Iteration}
\end{frame}

\begin{frame}
\frametitle{Temporal Difference Learning}
Value Function update at time $t$:
\[
	Q(s_t,a_t) \gets Q(s_t,a_t) + \alpha\left[\textcolor{blue}{G_t} - Q(s_t,a_t)\right] 
\]
\[
	\Delta Q(s_t,a_t) = \alpha\left[\textcolor{blue}{G_t} - Q(s_t,a_t)\right]
\]
\end{frame}

\begin{frame}
\frametitle{Expected Sarsa}
\begin{itemize}
\item \textbf{Forward view}: look one step forward to compute the target
\[
	G_t = r_{t+1} + \gamma\expect{a\sim\pi}{Q(s_{t+1},a)}
\]
\item \textbf{Backward view}: wait one step to update $Q(s_t,a_t)$
\begin{align*}
	\Delta Q(s_{t-1},a_{t-1}) = \alpha\left[r_t + \gamma\expect{a\sim\pi}{Q(s_t,a)} - Q(s_{t-1},a_{t-1})\right] 
\end{align*}

\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Temporal Credit Assignment Problem}
\end{frame}

\begin{frame}
\frametitle{n-step Expected Sarsa}
Look far (n steps) in the future:
\begin{align*}
	G_t^{(n)} &\doteq r_{t+1} + \gamma r_{t+2} + \dots + \gamma^{n-1}r_{t+n}
		+ \gamma^n\expect{a\sim\pi}{Q(s_{t+n},a)} \\
		& = \sum_{k=1}^{n}\gamma^{k-1}r_{t+k} +  \gamma^n\expect{a\sim\pi}{Q(s_{t+n},a)}
\end{align*}
\begin{itemize}
\item $G_t^{(1)}$ is a TD target
\item $G_t^{(T-t)}$ is a Monte Carlo target
\end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Eligibility Traces}

\frame{\tableofcontents[currentsection]}

\begin{frame}
\frametitle{Forward View}
Average \textbf{all} n-step targets:
\only<-2>{
\[
	G_t^{\lambda} \doteq (1-\lambda)\sum_{n=1}^{\only<1>{\infty}\only<2>{T}}\lambda^{n-1} G_t^{(n)}
\]
}
\only<3->{
\[
	G_t^{\lambda} = (1-\lambda)\sum_{n=1}^{T-t-1}\lambda^{n-1} G_t^{(n)} + \lambda^{T-t-1}G_t^{(T-t)}
\]
}
\begin{itemize}
\item<4-> $\lambda=0$ gives $G_t^{(1)}$, the TD target
\item<5-> $\lambda=1$ gives $G_t^{(T-t)}$, the Monte Carlo target
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Backward View}
Video here
\end{frame}

\begin{frame}
\frametitle{Eligibility Traces}
\end{frame}

\begin{frame}
\frametitle{Accumulating Traces}
Update at step $t$:
\begin{align*}
&
\only<1>{e(s,a) \gets \gamma\lambda e(s,a) + \mathbbm{1}\{s=s_t,a=a_t\}}
\only<2>{e \gets \gamma\lambda e + \mathbbm{1}_t} 
\\
\only<1>{& \Delta Q(s,a) = \alpha e(s,a)(G_t^{(1)} - Q(s,a))}
\only<2>{& \Delta Q = \alpha e\delta_t}
\end{align*}
\end{frame}

\begin{frame}
\frametitle{Replacing Traces}
Update at step $t$:
\begin{align*}
& 
e \gets \textcolor{red}{(1-\mathbbm{1}_t)}\gamma\lambda e + \mathbbm{1}_t \\
& \Delta Q = \alpha e\delta_t
\end{align*}
\end{frame}

\begin{frame}
\frametitle{Dutch Traces}
Update at step $t$:
\begin{align*}
& e \gets (1-\textcolor{red}{\alpha}\mathbbm{1}_t)\gamma\lambda e + \mathbbm{1}_t
\\
& \Delta Q = \alpha e\delta_t
\end{align*}
\end{frame}

\begin{frame}
\frametitle{General Traces}
Update at time t:
\begin{align*}
\only<1>{& \Delta Q = \alpha e_t\delta_t}
\only<2>{& \Delta Q = \alpha \gamma^t\left(\prod_{s=1}^tc_s\right)\delta_t}
\end{align*}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Off-policy Credit Assignment}
\frame{\tableofcontents[currentsection]}
%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Retrace($\lambda$)}
\frame{\tableofcontents[currentsection]}
%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Experiments}
\frame{\tableofcontents[currentsection]}
%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Title B1}

\begin{itemize}
\addtolength{\itemsep}{.2cm}
\item Lorem ipsum dolor sit amet, consectetur adipiscing elit.
\item Nulla id ex ornare, gravida nisi in, ornare risus.
  \begin{itemize}
    \addtolength{\itemsep}{.1cm}
  \item[1.] Aenean eu posuere purus.
  \item[2.] Etiam maximus convallis libero, ac venenatis nunc sagittis nec.
  \end{itemize}
\item Suspendisse orci ex, pharetra vitae aliquam ac, rutrum in dui.
\end{itemize}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Title B2}

\begin{theorem}[Th. Name]
\label{thlabel} This is a theorem
\begin{itemize}
\item Property 1;
\item Property 2.
\end{itemize}
\end{theorem}

\pause

\textit{Proof. }
\begin{align}
    a + b & = c \\
    a & = c - b \\
    answer & = 42
\end{align}
\qed

\pause

\begin{proof}
Another proof style.
\end{proof}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Title C1}

\begin{columns}[t, onlytextwidth]
\column{.33\textwidth}
First column.\\
\onslide<3>{\bigskip Appears with third column}
\pause{}
\column{.33\textwidth}
Second column.
\pause
\column{.33\textwidth}
Third column.
\end{columns}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Title C2}


\centering
Image:\\
\bigskip\bigskip
\includegraphics[height=2cm]{style_img/20090504_Politecnico_0006_02}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Title C3}


\begin{enumerate}
 \item lorem
 \item Ipsus
 \begin{enumerate}
    \item sub1
    \item sub3
    \begin{enumerate}
      \item sub4
      \item sub5
    \end{enumerate}
 \end{enumerate}
\end{enumerate}


\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Video}
\movie[width=\textwidth, height = 0.8\paperheight, poster, autostart, borderwidth=1pt]{}{video/test.mp4} 

\end{frame}


\end{document} 
